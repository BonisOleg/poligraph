from django.shortcuts import render
from django.http import JsonResponse
from django.views.decorators.csrf import csrf_exempt
from django.views.decorators.http import require_http_methods
from django.core.mail import send_mail
from django.conf import settings
import json
import requests
from datetime import datetime

def home(request):
    """–ì–æ–ª–æ–≤–Ω–∞ —Å—Ç–æ—Ä—ñ–Ω–∫–∞"""
    return render(request, 'main/home.html')

def services(request):
    """–°—Ç–æ—Ä—ñ–Ω–∫–∞ –ø–æ—Å–ª—É–≥"""
    context = {
        'services_list': [
            {
                'title': '–ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –ø–æ–¥—Ä—É–∂–∂—è –Ω–∞ –∑—Ä–∞–¥—É',
                'price': '5000 –≥—Ä–Ω',
                'discount': '–ó–Ω–∏–∂–∫–∞ 50% –Ω–∞ –¥—Ä—É–≥–æ–≥–æ –∑ –ø–æ–¥—Ä—É–∂–∂—è',
                'description': '–ü—Ä–æ—Ñ–µ—Å—ñ–π–Ω–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞ –Ω–∞ –¥–µ—Ç–µ–∫—Ç–æ—Ä—ñ –±—Ä–µ—Ö–Ω—ñ –¥–ª—è –∑\'—è—Å—É–≤–∞–Ω–Ω—è —Ñ–∞–∫—Ç—ñ–≤ –∑—Ä–∞–¥–∏',
                'icon': 'üíî',
                'features': [
                    '–ö–æ–Ω—Ñ—ñ–¥–µ–Ω—Ü—ñ–π–Ω—ñ—Å—Ç—å 100%',
                    '–î–µ—Ç–∞–ª—å–Ω–∏–π –∑–≤—ñ—Ç',
                    '–ü—Å–∏—Ö–æ–ª–æ–≥—ñ—á–Ω–∞ –ø—ñ–¥—Ç—Ä–∏–º–∫–∞',
                    '–ú–æ–∂–ª–∏–≤—ñ—Å—Ç—å –∑–∞–ø–∏—Å–∏ –≤—ñ–¥–µ–æ'
                ]
            },
            {
                'title': '–°–∫—Ä–∏–Ω—ñ–Ω–≥ –ø—Ä–∏ –ø—Ä–∞—Ü–µ–≤–ª–∞—à—Ç—É–≤–∞–Ω–Ω—ñ',
                'price': '2500/4000 –≥—Ä–Ω',
                'description': '–ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∫–∞–Ω–¥–∏–¥–∞—Ç—ñ–≤ –Ω–∞ —Ä–æ–±–æ—Ç—É –¥–ª—è –∑–∞–±–µ–∑–ø–µ—á–µ–Ω–Ω—è –Ω–∞–¥—ñ–π–Ω–æ—Å—Ç—ñ',
                'icon': 'üë•',
                'features': [
                    '–ë–∞–∑–æ–≤–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞ - 2500 –≥—Ä–Ω',
                    '–†–æ–∑—à–∏—Ä–µ–Ω–∏–π —Å–∫—Ä–∏–Ω—ñ–Ω–≥ - 4000 –≥—Ä–Ω',
                    '–ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Ä–µ–∑—é–º–µ',
                    '–û—Ü—ñ–Ω–∫–∞ —á–µ—Å–Ω–æ—Å—Ç—ñ'
                ]
            },
            {
                'title': '–ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –¥—ñ—é—á–æ–≥–æ –ø–µ—Ä—Å–æ–Ω–∞–ª—É',
                'price': '2500/4000 –≥—Ä–Ω',
                'description': '–†–µ–≥—É–ª—è—Ä–Ω–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Å–ø—ñ–≤—Ä–æ–±—ñ—Ç–Ω–∏–∫—ñ–≤ –¥–ª—è –ø—ñ–¥—Ç—Ä–∏–º–∫–∏ –¥–æ–≤—ñ—Ä–∏',
                'icon': 'üè¢',
                'features': [
                    '–ü–ª–∞–Ω–æ–≤—ñ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏',
                    '–†–æ–∑—Å–ª—ñ–¥—É–≤–∞–Ω–Ω—è –ø–æ—Ä—É—à–µ–Ω—å',
                    '–ö–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω–∞ –µ—Ç–∏–∫–∞',
                    '–ó–∞—Ö–∏—Å—Ç –≤—ñ–¥ —à–∞—Ö—Ä–∞–π—Å—Ç–≤–∞'
                ]
            },
            {
                'title': '–ü—Ä–∏–≤–∞—Ç–Ω—ñ –ø–∏—Ç–∞–Ω–Ω—è',
                'price': '5000 –≥—Ä–Ω',
                'description': '–ö–æ–Ω—Ñ—ñ–¥–µ–Ω—Ü—ñ–π–Ω—ñ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ –æ—Å–æ–±–∏—Å—Ç–∏—Ö –ø–∏—Ç–∞–Ω—å',
                'icon': 'üîí',
                'features': [
                    '–ü–æ–≤–Ω–∞ –∫–æ–Ω—Ñ—ñ–¥–µ–Ω—Ü—ñ–π–Ω—ñ—Å—Ç—å',
                    '–Ü–Ω–¥–∏–≤—ñ–¥—É–∞–ª—å–Ω–∏–π –ø—ñ–¥—Ö—ñ–¥',
                    '–ë–µ–∑–ø–µ—á–Ω–µ —Å–µ—Ä–µ–¥–æ–≤–∏—â–µ',
                    '–ü—ñ–¥—Ç—Ä–∏–º–∫–∞ –µ–∫—Å–ø–µ—Ä—Ç–∞'
                ]
            },
            {
                'title': '–†–æ–∑—Å–ª—ñ–¥—É–≤–∞–Ω–Ω—è –∫—Ä–∞–¥—ñ–∂–æ–∫',
                'price': '5000 –≥—Ä–Ω',
                'description': '–ü—Ä–æ—Ñ–µ—Å—ñ–π–Ω–µ —Ä–æ–∑—Å–ª—ñ–¥—É–≤–∞–Ω–Ω—è –≤–∏–ø–∞–¥–∫—ñ–≤ –∫—Ä–∞–¥—ñ–∂–æ–∫ —Ç–∞ —à–∞—Ö—Ä–∞–π—Å—Ç–≤–∞',
                'icon': 'üîç',
                'features': [
                    '–®–≤–∏–¥–∫–µ —Ä–æ–∑—Å–ª—ñ–¥—É–≤–∞–Ω–Ω—è',
                    '–ó–±—ñ—Ä –¥–æ–∫–∞–∑—ñ–≤',
                    '–°–ø—ñ–≤–ø—Ä–∞—Ü—è –∑ –ø—Ä–∞–≤–æ–æ—Ö–æ—Ä–æ–Ω—Ü—è–º–∏',
                    '–í—ñ–¥—à–∫–æ–¥—É–≤–∞–Ω–Ω—è –∑–±–∏—Ç–∫—ñ–≤'
                ]
            },
            {
                'title': '–ü–æ—à—É–∫–∏ –º–∞—Ç–µ—Ä—ñ–∞–ª—å–Ω–∏—Ö –¥–æ–∫–∞–∑—ñ–≤',
                'price': '5000 –≥—Ä–Ω',
                'discount': '–ó–Ω–∏–∂–∫–∞ –≤—ñ–π—Å—å–∫–æ–≤–∏–º 10%',
                'description': '–ü–æ—à—É–∫ —Ç–∞ –∑–±—ñ—Ä –¥–æ–∫–∞–∑–æ–≤–æ—ó –±–∞–∑–∏ –¥–ª—è —Å—É–¥–æ–≤–∏—Ö —Å–ø—Ä–∞–≤',
                'icon': '‚öñÔ∏è',
                'features': [
                    '–Æ—Ä–∏–¥–∏—á–Ω–∞ —Ü—ñ–Ω–Ω—ñ—Å—Ç—å',
                    '–î–æ–∫—É–º–µ–Ω—Ç—É–≤–∞–Ω–Ω—è –ø—Ä–æ—Ü–µ—Å—É',
                    '–ï–∫—Å–ø–µ—Ä—Ç–Ω—ñ –≤–∏—Å–Ω–æ–≤–∫–∏',
                    '–ü—ñ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–æ —Å—É–¥—É'
                ]
            }
        ]
    }
    return render(request, 'main/services.html', context)

def about(request):
    """–°—Ç–æ—Ä—ñ–Ω–∫–∞ –ø—Ä–æ –º–µ–Ω–µ"""
    context = {
        'certifications': [
            {
                'title': '–°–µ—Ä—Ç–∏—Ñ—ñ–∫–æ–≤–∞–Ω–∏–π –ø–æ–ª—ñ–≥—Ä–∞—Ñ–æ–ª–æ–≥',
                'organization': '–ù–∞—Ü—ñ–æ–Ω–∞–ª—å–Ω–∞ –ê—Å–æ—Ü—ñ–∞—Ü—ñ—è –ü–æ–ª—ñ–≥—Ä–∞—Ñ–æ–ª–æ–≥—ñ–≤ –£–∫—Ä–∞—ó–Ω–∏',
                'year': '2009',
                'description': '–û—Ñ—ñ—Ü—ñ–π–Ω–∞ —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—è –∑ –ø—Ä–∞–≤–∞ –ø—Ä–æ–≤–µ–¥–µ–Ω–Ω—è –ø–æ–ª—ñ–≥—Ä–∞—Ñ—ñ—á–Ω–∏—Ö –¥–æ—Å–ª—ñ–¥–∂–µ–Ω—å'
            },
            {
                'title': '–û—Ñ—ñ—Ü—ñ–π–Ω–∏–π –¥–∏–ª–µ—Ä Rubicon',
                'organization': 'Rubicon International',
                'year': '2015',
                'description': '–ê–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–∏–π –ø—Ä–µ–¥—Å—Ç–∞–≤–Ω–∏–∫ –ø—Ä–æ–≤—ñ–¥–Ω–æ–≥–æ –≤–∏—Ä–æ–±–Ω–∏–∫–∞ –ø–æ–ª—ñ–≥—Ä–∞—Ñ—ñ–≤'
            },
            {
                'title': '–°–ø–µ—Ü—ñ–∞–ª—ñ—Å—Ç –∑ –±–µ–∑–ø–µ–∫–∏',
                'organization': '–Ü–Ω—Å—Ç–∏—Ç—É—Ç –∫—Ä–∏–º—ñ–Ω–∞–ª—ñ—Å—Ç–∏–∫–∏',
                'year': '2008',
                'description': '–î–æ–¥–∞—Ç–∫–æ–≤–∞ –∫–≤–∞–ª—ñ—Ñ—ñ–∫–∞—Ü—ñ—è —É —Å—Ñ–µ—Ä—ñ –∫–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω–æ—ó –±–µ–∑–ø–µ–∫–∏'
            }
        ],
        'experience_years': 3,
        'cases_completed': 500,
        'accuracy_rate': 98
    }
    return render(request, 'main/about.html', context)

def equipment(request):
    """–°—Ç–æ—Ä—ñ–Ω–∫–∞ –æ–±–ª–∞–¥–Ω–∞–Ω–Ω—è"""
    context = {
        'main_device': {
            'name': 'Rubicon Polygraph',
            'model': 'Professional Series',
            'description': '–ù–∞–π—Å—É—á–∞—Å–Ω—ñ—à–∏–π –ø–æ–ª—ñ–≥—Ä–∞—Ñ –≤—ñ–¥ —Å–≤—ñ—Ç–æ–≤–æ–≥–æ –ª—ñ–¥–µ—Ä–∞',
            'features': [
                '–¶–∏—Ñ—Ä–æ–≤–∞ –æ–±—Ä–æ–±–∫–∞ —Å–∏–≥–Ω–∞–ª—ñ–≤',
                '–ë–∞–≥–∞—Ç–æ–∫–∞–Ω–∞–ª—å–Ω–∏–π –∑–∞–ø–∏—Å',
                '–ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∏–π –∞–Ω–∞–ª—ñ–∑',
                '–ó–∞—Ö–∏—â–µ–Ω–µ –∑–±–µ—Ä—ñ–≥–∞–Ω–Ω—è –¥–∞–Ω–∏—Ö'
            ],
            'specifications': {
                '–¢–æ—á–Ω—ñ—Å—Ç—å': '98.5%',
                '–ö—ñ–ª—å–∫—ñ—Å—Ç—å –∫–∞–Ω–∞–ª—ñ–≤': '8+',
                '–ß–∞—Å—Ç–æ—Ç–∞ –¥–∏—Å–∫—Ä–µ—Ç–∏–∑–∞—Ü—ñ—ó': '2000 –ì—Ü',
                '–°–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—è': 'APA Standards'
            }
        },
        'additional_equipment': [
            {
                'name': '–ö–∞–º–µ—Ä–∞ –≤—ñ–¥–µ–æ–∑–∞–ø–∏—Å—É',
                'description': 'HD –∑–∞–ø–∏—Å –ø—Ä–æ—Ü–µ—Å—É —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è'
            },
            {
                'name': '–ê—É–¥—ñ–æ—Å–∏—Å—Ç–µ–º–∞',
                'description': '–ö—Ä–∏—Å—Ç–∞–ª—å–Ω–æ —á–∏—Å—Ç–∏–π –∑–≤—É–∫'
            },
            {
                'name': '–ö–æ–º–ø\'—é—Ç–µ—Ä–Ω–∏–π –∫–æ–º–ø–ª–µ–∫—Å',
                'description': '–ü–æ—Ç—É–∂–Ω–∞ –æ–±—Ä–æ–±–∫–∞ –¥–∞–Ω–∏—Ö'
            }
        ]
    }
    return render(request, 'main/equipment.html', context)

def contacts(request):
    """–°—Ç–æ—Ä—ñ–Ω–∫–∞ –∫–æ–Ω—Ç–∞–∫—Ç—ñ–≤"""
    return render(request, 'main/contacts.html')

def reviews(request):
    """–°—Ç–æ—Ä—ñ–Ω–∫–∞ –≤—ñ–¥–≥—É–∫—ñ–≤"""
    context = {
        'reviews_list': [
            {
                'name': '–û–ª–µ–∫—Å–∞–Ω–¥—Ä –ö.',
                'service': '–ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –ø–µ—Ä—Å–æ–Ω–∞–ª—É',
                'rating': 5,
                'text': '–®–≤–∏–¥–∫–æ —Ç–∞ –ø—Ä–æ—Ñ–µ—Å—ñ–π–Ω–æ –≤–∏—è–≤–∏–ª–∏ –Ω–µ–¥–æ–±—Ä–æ—Å–æ–≤—ñ—Å–Ω–æ–≥–æ —Å–ø—ñ–≤—Ä–æ–±—ñ—Ç–Ω–∏–∫–∞. –†–µ–∫–æ–º–µ–Ω–¥—É—é!',
                'date': '15.12.2024'
            },
            {
                'name': '–ú–∞—Ä–∏–Ω–∞ –í.',
                'service': '–û—Å–æ–±–∏—Å—Ç—ñ –ø–∏—Ç–∞–Ω–Ω—è',
                'rating': 5,
                'text': '–î—É–∂–µ –¥–µ–ª—ñ–∫–∞—Ç–Ω–æ –ø—ñ–¥—ñ–π—à–ª–∏ –¥–æ –º–æ—î—ó —Å–∏—Ç—É–∞—Ü—ñ—ó. –û—Ç—Ä–∏–º–∞–ª–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ –Ω–∞ –≤—Å—ñ –ø–∏—Ç–∞–Ω–Ω—è.',
                'date': '28.11.2024'
            },
            {
                'name': '–¢–û–í "–¢–µ—Ö–Ω–æ—Å—Ñ–µ—Ä–∞"',
                'service': '–ö–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞',
                'rating': 5,
                'text': '–†–µ–≥—É–ª—è—Ä–Ω–æ –∫–æ—Ä–∏—Å—Ç—É—î–º–æ—Å—è –ø–æ—Å–ª—É–≥–∞–º–∏. –í–∏—Å–æ–∫–∏–π –ø—Ä–æ—Ñ–µ—Å—ñ–æ–Ω–∞–ª—ñ–∑–º —Ç–∞ —Ç–æ—á–Ω—ñ—Å—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤.',
                'date': '05.11.2024'
            }
        ]
    }
    return render(request, 'main/reviews.html', context)

# Telegram –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è
TELEGRAM_BOT_TOKEN = '7920924607:AAF6fKUGWZYKPBX8dvOQ_bgG4cJj0XQN98o'  # –ó–∞–º—ñ–Ω–∏—Ç–∏ –Ω–∞ –≤–∞—à —Ç–æ–∫–µ–Ω
TELEGRAM_CHAT_ID = '-1002428014069'  # –ó–∞–º—ñ–Ω–∏—Ç–∏ –Ω–∞ –≤–∞—à chat_id

def send_telegram_message(message):
    """–í—ñ–¥–ø—Ä–∞–≤–∫–∞ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –≤ Telegram"""
    try:
        url = f"https://api.telegram.org/bot{TELEGRAM_BOT_TOKEN}/sendMessage"
        data = {
            'chat_id': TELEGRAM_CHAT_ID,
            'text': message,
            'parse_mode': 'HTML'
        }
        response = requests.post(url, data=data, timeout=10)
        return response.status_code == 200
    except Exception as e:
        print(f"Telegram error: {e}")
        return False

@csrf_exempt
@require_http_methods(["POST"])
def send_contact_form(request):
    """API –¥–ª—è –≤—ñ–¥–ø—Ä–∞–≤–∫–∏ —Ñ–æ—Ä–º–∏ –∫–æ–Ω—Ç–∞–∫—Ç—ñ–≤ –≤ Telegram"""
    try:
        data = json.loads(request.body)
        name = data.get('name', '').strip()
        phone = data.get('phone', '').strip()
        service = data.get('service', '–ù–µ –≤–∫–∞–∑–∞–Ω–æ')
        message = data.get('message', '').strip()
        
        # –í–∞–ª—ñ–¥–∞—Ü—ñ—è
        if not name or len(name) < 2:
            return JsonResponse({'success': False, 'message': "–Ü–º'—è –ø–æ–≤–∏–Ω–Ω–æ –º—ñ—Å—Ç–∏—Ç–∏ –º—ñ–Ω—ñ–º—É–º 2 —Å–∏–º–≤–æ–ª–∏"})
        
        if not phone:
            return JsonResponse({'success': False, 'message': '–¢–µ–ª–µ—Ñ–æ–Ω —î –æ–±–æ–≤\'—è–∑–∫–æ–≤–∏–º'})
        
        # –§–æ—Ä–º—É–≤–∞–Ω–Ω—è –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –¥–ª—è Telegram
        telegram_message = f"""
üîî <b>–ù–æ–≤–∞ –∑–∞—è–≤–∫–∞ –∑ —Å–∞–π—Ç—É!</b>

üë§ <b>–Ü–º'—è:</b> {name}
üìû <b>–¢–µ–ª–µ—Ñ–æ–Ω:</b> {phone}
üéØ <b>–ü–æ—Å–ª—É–≥–∞:</b> {service}

üìù <b>–ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è:</b>
{message if message else '–ù–µ –≤–∫–∞–∑–∞–Ω–æ'}

üìÖ <b>–ß–∞—Å:</b> {datetime.now().strftime('%d.%m.%Y %H:%M')}
"""
        
        # –í—ñ–¥–ø—Ä–∞–≤–∫–∞ –≤ Telegram
        if send_telegram_message(telegram_message):
            return JsonResponse({'success': True, 'message': '–ó–∞—è–≤–∫—É —É—Å–ø—ñ—à–Ω–æ –≤—ñ–¥–ø—Ä–∞–≤–ª–µ–Ω–æ!'})
        else:
            return JsonResponse({'success': False, 'message': '–ü–æ–º–∏–ª–∫–∞ –≤—ñ–¥–ø—Ä–∞–≤–∫–∏. –°–ø—Ä–æ–±—É–π—Ç–µ –∑–∞—Ç–µ–ª–µ—Ñ–æ–Ω—É–≤–∞—Ç–∏.'})
            
    except json.JSONDecodeError:
        return JsonResponse({'success': False, 'message': '–ù–µ–≤—ñ—Ä–Ω–∏–π —Ñ–æ—Ä–º–∞—Ç –¥–∞–Ω–∏—Ö'})
    except Exception as e:
        print(f"Contact form error: {e}")
        return JsonResponse({'success': False, 'message': '–í–Ω—É—Ç—Ä—ñ—à–Ω—è –ø–æ–º–∏–ª–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞'})

@csrf_exempt
@require_http_methods(["POST"])
def send_review_form(request):
    """API –¥–ª—è –≤—ñ–¥–ø—Ä–∞–≤–∫–∏ —Ñ–æ—Ä–º–∏ –≤—ñ–¥–≥—É–∫—ñ–≤ –≤ Telegram"""
    try:
        data = json.loads(request.body)
        name = data.get('name', '').strip()
        service = data.get('service', '–ù–µ –≤–∫–∞–∑–∞–Ω–æ')
        rating = data.get('rating', '')
        review = data.get('review', '').strip()
        
        # –í–∞–ª—ñ–¥–∞—Ü—ñ—è
        if not name or len(name) < 2:
            return JsonResponse({'success': False, 'message': "–Ü–º'—è –ø–æ–≤–∏–Ω–Ω–æ –º—ñ—Å—Ç–∏—Ç–∏ –º—ñ–Ω—ñ–º—É–º 2 —Å–∏–º–≤–æ–ª–∏"})
        
        if not rating:
            return JsonResponse({'success': False, 'message': '–û–±–µ—Ä—ñ—Ç—å —Ä–µ–π—Ç–∏–Ω–≥'})
        
        if not review or len(review) < 10:
            return JsonResponse({'success': False, 'message': '–í—ñ–¥–≥—É–∫ –ø–æ–≤–∏–Ω–µ–Ω –º—ñ—Å—Ç–∏—Ç–∏ –º—ñ–Ω—ñ–º—É–º 10 —Å–∏–º–≤–æ–ª—ñ–≤'})
        
        # –§–æ—Ä–º—É–≤–∞–Ω–Ω—è –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –¥–ª—è Telegram
        stars = '‚≠ê' * int(rating)
        telegram_message = f"""
üìù <b>–ù–æ–≤–∏–π –≤—ñ–¥–≥—É–∫!</b>

üë§ <b>–Ü–º'—è:</b> {name}
üéØ <b>–ü–æ—Å–ª—É–≥–∞:</b> {service}
‚≠ê <b>–†–µ–π—Ç–∏–Ω–≥:</b> {stars} ({rating}/5)

üí¨ <b>–í—ñ–¥–≥—É–∫:</b>
{review}

üìÖ <b>–ß–∞—Å:</b> {datetime.now().strftime('%d.%m.%Y %H:%M')}
"""
        
        # –í—ñ–¥–ø—Ä–∞–≤–∫–∞ –≤ Telegram
        if send_telegram_message(telegram_message):
            return JsonResponse({'success': True, 'message': '–í—ñ–¥–≥—É–∫ —É—Å–ø—ñ—à–Ω–æ –≤—ñ–¥–ø—Ä–∞–≤–ª–µ–Ω–æ!'})
        else:
            return JsonResponse({'success': False, 'message': '–ü–æ–º–∏–ª–∫–∞ –≤—ñ–¥–ø—Ä–∞–≤–∫–∏. –°–ø—Ä–æ–±—É–π—Ç–µ –ø—ñ–∑–Ω—ñ—à–µ.'})
            
    except json.JSONDecodeError:
        return JsonResponse({'success': False, 'message': '–ù–µ–≤—ñ—Ä–Ω–∏–π —Ñ–æ—Ä–º–∞—Ç –¥–∞–Ω–∏—Ö'})
    except Exception as e:
        print(f"Review form error: {e}")
        return JsonResponse({'success': False, 'message': '–í–Ω—É—Ç—Ä—ñ—à–Ω—è –ø–æ–º–∏–ª–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞'})

@csrf_exempt  
@require_http_methods(["POST"])
def send_quick_order(request):
    """API –¥–ª—è —à–≤–∏–¥–∫–æ–≥–æ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è –ø–æ—Å–ª—É–≥–∏"""
    try:
        data = json.loads(request.body)
        name = data.get('name', '').strip()
        phone = data.get('phone', '').strip()
        service = data.get('service', '')
        
        # –í–∞–ª—ñ–¥–∞—Ü—ñ—è
        if not name or len(name) < 2:
            return JsonResponse({'success': False, 'message': "–Ü–º'—è –ø–æ–≤–∏–Ω–Ω–æ –º—ñ—Å—Ç–∏—Ç–∏ –º—ñ–Ω—ñ–º—É–º 2 —Å–∏–º–≤–æ–ª–∏"})
        
        if not phone:
            return JsonResponse({'success': False, 'message': '–¢–µ–ª–µ—Ñ–æ–Ω —î –æ–±–æ–≤\'—è–∑–∫–æ–≤–∏–º'})
            
        if not service:
            return JsonResponse({'success': False, 'message': '–û–±–µ—Ä—ñ—Ç—å –ø–æ—Å–ª—É–≥—É'})
        
        # –§–æ—Ä–º—É–≤–∞–Ω–Ω—è –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –¥–ª—è Telegram
        telegram_message = f"""
‚ö° <b>–®–≤–∏–¥–∫–µ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è!</b>

üë§ <b>–Ü–º'—è:</b> {name}
üìû <b>–¢–µ–ª–µ—Ñ–æ–Ω:</b> {phone}
üéØ <b>–ü–æ—Å–ª—É–≥–∞:</b> {service}

üìÖ <b>–ß–∞—Å:</b> {datetime.now().strftime('%d.%m.%Y %H:%M')}
"""
        
        # –í—ñ–¥–ø—Ä–∞–≤–∫–∞ –≤ Telegram
        if send_telegram_message(telegram_message):
            return JsonResponse({'success': True, 'message': '–ó–∞–º–æ–≤–ª–µ–Ω–Ω—è –ø—Ä–∏–π–Ω—è—Ç–æ! –ü–µ—Ä–µ–¥–∑–≤–æ–Ω–∏–º–æ –ø—Ä–æ—Ç—è–≥–æ–º 15 —Ö–≤–∏–ª–∏–Ω.'})
        else:
            return JsonResponse({'success': False, 'message': '–ü–æ–º–∏–ª–∫–∞ –≤—ñ–¥–ø—Ä–∞–≤–∫–∏. –ó–∞—Ç–µ–ª–µ—Ñ–æ–Ω—É–π—Ç–µ –Ω–∞–º.'})
            
    except json.JSONDecodeError:
        return JsonResponse({'success': False, 'message': '–ù–µ–≤—ñ—Ä–Ω–∏–π —Ñ–æ—Ä–º–∞—Ç –¥–∞–Ω–∏—Ö'})
    except Exception as e:
        print(f"Quick order error: {e}")
        return JsonResponse({'success': False, 'message': '–í–Ω—É—Ç—Ä—ñ—à–Ω—è –ø–æ–º–∏–ª–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞'}) 